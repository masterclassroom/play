<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üè± Received Gifts</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f6fa;
      color: #2f3640;
      text-align: center;
    }h2 {
  margin-bottom: 20px;
  color: #0984e3;
}

.gift-card {
  background: #ffffff;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  padding: 20px;
  margin: 20px auto;
  max-width: 400px;
  text-align: left;
  transition: transform 0.3s ease;
}

.gift-card:hover {
  transform: translateY(-4px);
}

.profile {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 15px;
}

.profile img {
  width: 60px;
  height: 60px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid #0984e3;
}

.profile-info {
  display: flex;
  flex-direction: column;
}

.profile-info strong {
  font-size: 17px;
  color: #2d3436;
}

.profile-info small {
  color: #636e72;
  font-size: 14px;
}

.gift-date {
  color: #636e72;
  font-size: 14px;
  margin-bottom: 8px;
}

.gift-level {
  margin: 10px 0;
  font-weight: bold;
  color: #d63031;
}

select, .claim-btn {
  width: 100%;
  padding: 10px;
  font-size: 15px;
  margin-top: 10px;
  border-radius: 8px;
  border: none;
  outline: none;
}

select {
  background-color: #dfe6e9;
}

.claim-btn {
  background-color: #00b894;
  color: white;
  cursor: pointer;
}

.claim-btn:hover {
  background-color: #55efc4;
}

.btn-back {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background-color: #0984e3;
  color: white;
  padding: 12px 20px;
  border-radius: 30px;
  border: none;
  font-size: 16px;
  cursor: pointer;
  z-index: 1000;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

.btn-back:hover {
  background-color: #74b9ff;
}

.summary {
  background: #dff9fb;
  padding: 10px 15px;
  border-radius: 10px;
  max-width: 300px;
  margin: 10px auto 30px auto;
  font-size: 16px;
  color: #130f40;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

  </style>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>  <h2>üè± Received Gifts</h2>
  <div id="summary" class="summary">Total Gifts: 0</div>
  <div id="giftList">Loading...</div>
  <button class="btn-back" onclick="history.back()">‚¨ÖÔ∏è Back</button>  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getDatabase, ref, get, update, remove } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBAj0xbIZhcmWiSf3nYVgIIgTZ_KJ64mTE",
      authDomain: "exam-81b90.firebaseapp.com",
      databaseURL: "https://exam-81b90-default-rtdb.firebaseio.com",
      projectId: "exam-81b90",
      storageBucket: "exam-81b90.appspot.com",
      messagingSenderId: "461178422237",
      appId: "1:461178422237:web:8433ab42b524b0a17bac34"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth();

    const giftValues = {
      low: 100,
      medium: 500,
      high: 1000
    };

    const giftList = document.getElementById("giftList");
    const summary = document.getElementById("summary");

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        Swal.fire("Please login first");
        location.href = "login.html";
        return;
      }

      const uid = user.uid;
      const sendSnap = await get(ref(db, `send/${uid}`));

      if (!sendSnap.exists()) {
        giftList.innerText = "No gifts received.";
        summary.innerText = "Total Gifts: 0";
        return;
      }

      const sendData = sendSnap.val();
      giftList.innerHTML = "";
      let totalGifts = 0;

      for (const senderId in sendData) {
        const giftsFromSender = sendData[senderId];

        const senderSnap = await get(ref(db, `users/${senderId}`));
        const sender = senderSnap.val() || {};
        const name = sender.displayname || "Unknown";
        const username = sender.username || "unknown";
        const avatar = `${sender.logo || "default"}.png`;

        for (const giftId in giftsFromSender) {
          totalGifts++;
          const giftInfo = giftsFromSender[giftId];
          const giftLevel = giftInfo.gift;
          const dateText = new Date(giftInfo.timestamp).toLocaleString("en-US", {
            year: "numeric",
            month: "short",
            day: "numeric",
            hour: "numeric",
            minute: "2-digit",
            hour12: true
          });

          const card = document.createElement("div");
          card.className = "gift-card";

          card.innerHTML = `
            <div class="profile">
              <img src="${avatar}" alt="Avatar">
              <div class="profile-info">
                <strong>${name}</strong>
                <small>@${username}</small>
              </div>
            </div>
            <div class="gift-date">üìÖ ${dateText}</div>
            <div class="gift-level">üè± ${giftLevel.toUpperCase()} Gift</div>
            <select id="select-${senderId}-${giftId}">
              <option value="coins">Claim as Coins</option>
              <option value="gift">Claim as Gift</option>
            </select>
            <button class="claim-btn" id="claim-${senderId}-${giftId}">Claim</button>
          `;

          giftList.appendChild(card);

          document.getElementById(`claim-${senderId}-${giftId}`).addEventListener("click", async () => {
            const choice = document.getElementById(`select-${senderId}-${giftId}`).value;

            const userSnap = await get(ref(db, `users/${uid}`));
            const userData = userSnap.val() || {};
            const currentGifts = userData.gifts || {};
            const currentCoins = userData.coins || 0;

            const value = giftValues[giftLevel] || 0;
            const updates = {};
            let message = "";

            if (choice === "coins") {
              updates.coins = currentCoins + value;
              message = `You received ${value} coins from a ${giftLevel} gift.`;
            } else {
              updates[`gifts/${giftLevel}`] = (currentGifts[giftLevel] || 0) + 1;
              message = `You claimed 1 ${giftLevel} gift to your gift inventory.`;
            }

            await update(ref(db, `users/${uid}`), updates);
            await remove(ref(db, `send/${uid}/${senderId}/${giftId}`));
            Swal.fire("Gift Claimed!", message, "success");
            card.remove();
            totalGifts--;
            summary.innerText = `Total Gifts: ${totalGifts}`;
          });
        }
      }

      summary.innerText = `Total Gifts: ${totalGifts}`;
    });
  </script></body>
</html>